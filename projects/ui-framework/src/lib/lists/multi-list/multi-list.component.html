<b-search *ngIf="shouldDisplaySearch"
          #search
          (searchChange)="searchChange($event)"
          [ngClass]="{ 'no-result': !listOptions?.length }">
</b-search>

<div [ngStyle]="{
        height: listOptions && (listOptions.length * listElHeight + 'px')
      }"
     [attr.aria-readonly]="readonly || null"
     [ngClass]="{
       'no-group-header': noGroupHeaders
      }"
     class="v-scroll-wrapper">
  <div #headers
       class="headers"
       *ngIf="!noGroupHeaders">
    <div *ngFor="let header of listHeaders; let headerIndex =  index; trackBy: headerTrackBy"
         class="headers-group">
      <div [ngClass]="{
            'clickable': options.length > 1 || (header.groupIsOption && !readonly),
            'collapsed': header.isCollapsed,
            'focus': focusOption?.isPlaceHolder && isSameGroup(focusOption, header),
            'selected': header.selected,
            'indeterminate': header.indeterminate
          }"
           class="option-select header has-hover">
        <span (click)="headerClick(header, headerIndex)"
              class="header-collapse-trigger">
        </span>
        <span *ngIf="options.length > 1 && !header.groupIsOption"
              class="chevron b-icon-medium"
              [ngClass]="{
                'b-icon-chevron-down': !header.isCollapsed,
                'b-icon-chevron-right': header.isCollapsed
              }"></span>
        <div class="header-option">
          <span *ngIf="header.hasCheckbox && !readonly"
                [hidden]="searchValue"
                class="checkbox bml-checkbox"
                (click)="selectGroup(header, headerIndex)"></span>

          <span class="header-option-value"
                data-max-lines='3'
                [innerHTML]="header.groupName | highlight: searchValue"></span>
          <span *ngIf="header.selectedCount > 0"
                class="header-selected-count">
            ({{header.selectedCount}})
          </span>
        </div>
      </div>
      <div [ngStyle]="{height: header.isCollapsed ? 0 : header.placeHolderSize + 'px'}"
           class="placeholder"></div>
    </div>
  </div>

  <cdk-virtual-scroll-viewport #vScroll
                               class="v-scroll"
                               [itemSize]="listElHeight"
                               maxBufferPx="{{8*listElHeight}}"
                               minBufferPx="{{8*listElHeight}}">
    <div class="options">
      <div (click)="optionClick(option, true)"
           *cdkVirtualFor="let option of listOptions"
           [ngClass]="{
            'header-placeholder': option.isPlaceHolder,
            'option': !option.isPlaceHolder,
            'selected': readonly && option.selected,
            'focus': option.id===focusOption?.id,
            'disabled': option.disabled || (!option.selected && max && selectedIDs?.length >= max) || (option.selected
            && min && selectedIDs?.length <= min),
            'single-group-option': options.length === 1
           }"
           class="option-select">

        <span *ngIf="!option.isPlaceHolder && !readonly"
              class="checkbox"
              [ngClass]="{
                 'bml-checkbox': mode !== modes.radioGroups,
                 'bml-radio': mode === modes.radioGroups,
                'selected': option.selected
              }"></span>

        <b-component-renderer *ngIf="option.prefixComponent
                        && option.prefixComponent.component"
                              class="comp-prefix"
                              [render]="option.prefixComponent"></b-component-renderer>

        <span *ngIf="!option.isPlaceHolder && option.value"
              class="option-value"
              data-max-lines='3'
              [innerHTML]="option.value | highlight: searchValue">
        </span>

      </div>
    </div>
  </cdk-virtual-scroll-viewport>

</div>

<b-list-footer #footer
               *ngIf="hasFooter"
               [listActions]="!readonly ? listActions : {}"
               [listActionsState]="!readonly ? listActionsState : {}"
               (apply)="onApply()"
               (cancel)="onCancel()"
               (clear)="clearList()"
               (reset)="resetList()">
  <ng-content footerAction
              select="[footerAction],[footerActionRight]"></ng-content>
</b-list-footer>
