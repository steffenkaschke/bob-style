<ng-template #listItem
             let-index="index"
             let-item="item">

  <li class="btl-item"
      [id]="item.id"
      [attr.data-index]="index"
      [attr.data-level]="item.parentCount || 1"
      tabindex="0"
      [ngClass]="{
        'btl-item-option': !item.childrenCount,
        'btl-item-group': item.childrenCount,
        disabled: item.disabled || (type === selectType.multi && item.parentSelected),
        selected: item.selected || (type === selectType.multi && item.parentSelected),
        expanded: item.childrenCount && !item.collapsed,
        collapsed: item.collapsed,
        'next-is-group': item.nextInViewIsGroup,
        'all-options-hidden': item.allOptionsHidden
      }">

    <span *ngIf="item.childrenCount"
          class="btl-item-chevron has-hover"
          role="button"></span>

    <span *ngIf="showCheckbox()"
          class="btl-item-checkbox"
          role="checkbox"
          [attr.aria-checked]="item.selected"></span>

    <span class="btl-item-name"
          data-max-lines='3'
          [innerHTML]="item.name | highlight: searchValue">
      {{item.name}}
    </span>

    <span *ngIf="item.selectedCount"
          class="btl-selected-count">
      ({{item.selectedCount}})
    </span>
  </li>

</ng-template>


<b-search *ngIf="showSearch"
          #search
          class="btl-search"
          [ngClass]="{
            'no-results': !listViewModel.length
          }"
          (searchChange)="searchChange($event)">
</b-search>

<ul #listElement
    class="btl-list"
    [attr.data-type]="type"
    [attr.aria-readonly]="readonly || null"
    [attr.aria-disabled]="disabled || null"
    (click)="onListClick($event)"
    (keydown)="onListKeyDown($event)">

  <ng-container *ngFor="let itemID of $listViewModel | async; let index = index; trackBy: trackBy">
    <ng-container *ngTemplateOutlet="listItem; context: {
      index: index,
      item: itemsMap.get(itemID)
    }"></ng-container>
  </ng-container>

</ul>

<b-list-footer #footer
               *ngIf="hasFooter"
               class="btl-footer"
               [listActions]="!readonly ? listActions : {}"
               [listActionsState]="!readonly ? listActionsState : {}"
               (apply)="onApply()"
               (cancel)="onCancel()"
               (clear)="clearList()"
               (reset)="resetList()">
  <ng-content footerAction
              select="[footerAction],[footerActionRight]"></ng-content>
</b-list-footer>


<div class="dev"
     *ngIf="debug">
  <p>Total items: {{ itemsMap.size - 1 }}</p>
  <p>Total items in view: {{ listViewModel.length }}</p>
  <p>Total selected: {{ itemsMap.get('#root') && itemsMap.get('#root').selectedCount }}</p>
  <button type="button"
          (click)="log('Data')">Log data</button>
  <button type="button"
          (click)="log('ValuesMap')">Log ID to Values map</button>
  <button type="button"
          (click)="log('ViewContext')">Log items View Context</button>
  <button type="button"
          (click)="log('Value')">Log Value</button>
</div>
